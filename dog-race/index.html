<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Typing Dog Race</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #fdf6ec;
      padding: 20px;
      max-width: 700px;
      margin: auto;
    }

    h1 {
      text-align: center;
    }

    .track {
      position: relative;
      height: 70px;
      margin: 30px 0;
      background: #e0e0e0;
      border-radius: 30px;
      overflow: hidden;
    }

    .dog {
      position: absolute;
      font-size: 40px;
      left: 0;
      top: 25px;
      transition: left 0.1s linear;
    }

    .label {
      position: absolute;
      top: 0;
      font-weight: bold;
      background: rgba(255,255,255,0.7);
      padding: 2px 6px;
      border-radius: 8px;
      white-space: nowrap;
    }

    .typing-box {
      width: 100%;
      font-size: 18px;
      padding: 10px;
      margin-top: 10px;
    }

    .sentence {
      font-size: 18px;
      margin: 10px 0;
    }

    #winner {
      font-size: 22px;
      text-align: center;
      margin-top: 20px;
      font-weight: bold;
    }

    .settings {
      margin-bottom: 20px;
    }

    .error {
      background-color: #ffdddd;
    }

    #countdown {
      font-size: 30px;
      text-align: center;
      margin-top: 10px;
      font-weight: bold;
      color: #aa0000;
    }
  </style>
</head>
<body>

  <h1>üê∂ Typing Dog Race</h1>

  <div class="settings">
    <label>Your Name:</label>
    <input type="text" id="playerName" value="You" />
    <label>Your WPM:</label>
    <input type="number" id="playerWPM" value="70" />
    <button onclick="startCountdown()">Start Race</button>
  </div>

  <div id="countdown"></div>

  <div class="sentence" id="sentenceText"></div>
  <input type="text" id="input" class="typing-box" placeholder="Start typing..." disabled />

  <div class="track">
    <span class="dog" id="playerDog">üê∂</span>
    <span class="label" id="playerLabel"></span>
  </div>
  <div class="track">
    <span class="dog" id="bot1">üêï</span>
    <span class="label" id="bot1Label"></span>
  </div>
  <div class="track">
    <span class="dog" id="bot2">ü¶Æ</span>
    <span class="label" id="bot2Label"></span>
  </div>
  <div class="track">
    <span class="dog" id="bot3">üêï‚Äçü¶∫</span>
    <span class="label" id="bot3Label"></span>
  </div>

  <div id="winner"></div>

  <script>
    const sentence = "The quick brown fox jumps over the lazy dog";
    const sentenceText = document.getElementById("sentenceText");
    const input = document.getElementById("input");
    const trackWidth = 600;
    const dogNames = ["Max", "Bella", "Charlie"];
    let player, bots, finished, raceStarted = false;

    sentenceText.textContent = sentence;

    function startCountdown() {
      document.getElementById("countdown").textContent = "Get Ready!";
      input.value = "";
      input.disabled = true;
      document.getElementById("winner").textContent = "";
      finished = [];
      raceStarted = false;

      let count = 3;
      const countdown = setInterval(() => {
        document.getElementById("countdown").textContent = count > 0 ? count : "GO!";
        if (count === 0) {
          clearInterval(countdown);
          document.getElementById("countdown").textContent = "";
          startRace();
        }
        count--;
      }, 1000);
    }

    function startRace() {
      const playerName = document.getElementById("playerName").value || "You";
      const playerWPM = parseInt(document.getElementById("playerWPM").value) || 60;

      player = {
        id: "playerDog",
        label: "playerLabel",
        name: playerName,
        wpm: playerWPM,
        position: 0,
        done: false
      };

      bots = [1, 2, 3].map((n, i) => ({
        id: "bot" + n,
        label: "bot" + n + "Label",
        name: dogNames[i],
        wpm: playerWPM + Math.floor(Math.random() * 10 - 5),
        position: 0,
        done: false
      }));

      finished = [];
      raceStarted = true;
      input.disabled = false;
      input.focus();

      document.getElementById(player.label).textContent = player.name;
      bots.forEach(bot => {
        document.getElementById(bot.label).textContent = bot.name;
      });

      moveBots();
      trackPlayerTyping();
    }

    function moveBots() {
      bots.forEach(bot => {
        const botDog = document.getElementById(bot.id);
        const botLabel = document.getElementById(bot.label);
        const interval = setInterval(() => {
          if (!raceStarted || bot.done) return;
          const wordsPerSecond = bot.wpm / 60;
          bot.position += wordsPerSecond / sentence.split(" ").length;
          const left = Math.min(bot.position, 1) * trackWidth;
          botDog.style.left = `${left}px`;
          botLabel.style.left = `${left - 40}px`;

          if (bot.position >= 1 && !bot.done) {
            bot.done = true;
            finished.push(bot.name);
            checkFinish();
            clearInterval(interval);
          }
        }, 200);
      });
    }

    function trackPlayerTyping() {
      const dog = document.getElementById(player.id);
      const label = document.getElementById(player.label);

      input.addEventListener("input", () => {
        if (!raceStarted || player.done) return;

        const typed = input.value;
        const expected = sentence.slice(0, typed.length);

        if (typed !== expected) {
          input.classList.add("error");
          input.value = typed.slice(0, -1); // remove the incorrect char
          return;
        } else {
          input.classList.remove("error");
        }

        const progress = typed.length / sentence.length;
        player.position = progress;
        const left = progress * trackWidth;
        dog.style.left = `${left}px`;
        label.style.left = `${left - 40}px`;

        if (typed === sentence && !player.done) {
          player.done = true;
          finished.push(player.name);
          input.disabled = true;
          checkFinish();
        }
      });
    }

    function checkFinish() {
      if (finished.length === 4) {
        const places = ["ü•á 1st", "ü•à 2nd", "ü•â 3rd", "üèÅ 4th"];
        const results = finished.map((name, i) => `${places[i]}: ${name}`);
        document.getElementById("winner").innerHTML = results.join("<br>");
        raceStarted = false;
      }
    }
  </script>

</body>
</html>
